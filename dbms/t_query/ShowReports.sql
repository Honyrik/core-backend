--liquibase formatted sql
--changeset artemov_i:ShowReports.sql dbms:postgresql runOnChange:true splitStatements:false stripComments:false
INSERT INTO s_mt.t_query (ck_id, cc_query, ck_provider, ck_user, ct_change, cr_type, cr_access, cn_action, cv_description) VALUES ('ShowReports', 'E''--ShowReports\r\nselect \r\n       /* Пагинация */\r\n       count(*) over() as jn_total_cnt,\r\n       /* Отчеты */\r\n       tr.ck_id,\r\n       tr.cd_st,\r\n       tr.cd_expire,\r\n       tr.cv_filename,\r\n       tr.cv_url,\r\n       tr.ck_format,\r\n       tr.cl_online,\r\n       tr.cv_request,\r\n       tr.cv_result,\r\n       tr.cv_status,\r\n       tr.cv_status_decode,\r\n       tr.cc_param,\r\n       tr.ck_user,\r\n       tr.ct_change at time zone to_char(:sess_cv_timezone) as ct_change\r\n  from (\r\n         select tr.ck_id,\r\n                tr.cd_st,\r\n                tr.cd_expire,\r\n                tr.cv_filename,\r\n                tr.cv_url,\r\n                tr.ck_format,\r\n                tr.cl_online,\r\n                tr.cv_request,\r\n                tr.cv_result,\r\n                tr.cv_status,\r\n                decode(tr.cv_status,\''execution\'',\''выполнение\'',\''ready\'',\''готов\'',\''cancelled\'',\''отменен\'',\''failed\'',\''ошибка формирования\'',\''queued\'',\'' в очереди\'', \''expired\'', \''истёк срок хранения\'',null) as cv_status_decode,\r\n                tr.cc_param,\r\n                tr.ck_user,\r\n                tr.ct_change\r\n           from table(pkg_json_report.f_show_report(:json, :sess_ck_id)) tr\r\n       ) tr\r\n where &FILTER\r\n order by &SORT\r\noffset json_value(:json, \''$.filter.jn_offset\'' returning number) rows\r\n fetch next json_value(:json, \''$.filter.jn_fetch\'' returning number) rows only ''', 'meta', '-11', '2018-12-07 17:56:58.667266+03', 'select', 'po_session', NULL, 'Необходимо актуализировать')
on conflict (ck_id) do update set cc_query = excluded.cc_query, ck_provider = excluded.ck_provider, ck_user = excluded.ck_user, ct_change = excluded.ct_change, cr_type = excluded.cr_type, cr_access = excluded.cr_access;

