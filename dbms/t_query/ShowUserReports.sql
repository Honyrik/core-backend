--liquibase formatted sql
--changeset artemov_i:ShowUserReports.sql dbms:postgresql runOnChange:true splitStatements:false stripComments:false
INSERT INTO s_mt.t_query (ck_id, cc_query, ck_provider, ck_user, ct_change, cr_type, cr_access, cn_action, cv_description) VALUES ('ShowUserReports', 'E''--ShowUserReports\nselect \n       /* Пагинация */\n       count(*) over() as jn_total_cnt,\n       /* Отчеты */\n       tr.ck_id,\n       tr.cd_st,\n       tr.cd_expire,\n       tr.cv_filename,\n       tr.cv_url,\n       tr.cv_name,\n       tr.ck_format,\n       tr.cl_online,\n       tr.cv_request,\n       tr.cv_result,\n       tr.cv_status,\n       tr.cv_status_decode,\n       tr.cc_param,\n       tr.ck_user,\n       tr.ct_change at time zone to_char(:sess_cv_timezone) as ct_change\n  from (\n         select tr.ck_id,\n                tr.cd_st,\n                tr.cd_expire,\n                tr.cv_filename,\n                tr.cv_url,\n                substr(tr.cv_url, instr(tr.cv_url, \''/\'' , -1) + 1) as cv_name,\n                tr.ck_format,\n                tr.cl_online,\n                tr.cv_request,\n                tr.cv_result,\n                tr.cv_status,\n                decode(tr.cv_status,\''execution\'',\''выполнение\'',\''ready\'',\''готов\'',\''cancelled\'',\''отменен\'',\''failed\'',\''ошибка формирования\'',\''queued\'',\'' в очереди\'', \''expired\'', \''истёк срок хранения\'',null) as cv_status_decode,\n                tr.cc_param,\n                tr.ck_user,\n                tr.ct_change\n           from table(pkg_json_report.f_show_report(:json, :sess_ck_id)) tr\n       ) tr\n where &FILTER\n order by &SORT\noffset json_value(:json, \''$.filter.jn_offset\'' returning number) rows\n fetch next json_value(:json, \''$.filter.jn_fetch\'' returning number) rows only ''', 'meta', '-11', '2018-12-07 17:56:58.668827+03', 'select', 'po_session', NULL, 'Необходимо актуализировать')
on conflict (ck_id) do update set cc_query = excluded.cc_query, ck_provider = excluded.ck_provider, ck_user = excluded.ck_user, ct_change = excluded.ct_change, cr_type = excluded.cr_type, cr_access = excluded.cr_access;

